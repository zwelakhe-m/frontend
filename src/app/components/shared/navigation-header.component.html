<!-- Navigation Header -->
@if (shouldShowNav()) {
<nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-40">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo and Brand -->
      <div class="flex items-center">
        <a routerLink="/" class="flex items-center space-x-2 group">
          <span
            class="inline-flex items-center justify-center w-9 h-9 rounded-lg bg-purple-600 shadow-sm"
          >
            <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M3 12L12 5L21 12"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <rect x="7" y="12" width="10" height="7" rx="2" fill="white" fill-opacity="0.95" />
            </svg>
          </span>
          <span
            class="text-xl font-bold text-gray-900 group-hover:text-purple-700 transition-colors duration-200"
          >
            RentHub
          </span>
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-1">
        @for (item of getFilteredNavItems(); track item.route) {
        <a
          [routerLink]="item.route"
          [class]="getNavItemClass(item.route)"
          class="nav-item relative"
        >
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <g [innerHTML]="getIconSvg(item.icon)"></g>
          </svg>
          {{ item.label }}
          @if (item.hasCount && item.label === 'Messages' && unreadMessagesCount() > 0) {
          <span
            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
          >
            {{ unreadMessagesCount() > 99 ? '99+' : unreadMessagesCount() }}
          </span>
          }
        </a>
        }
      </div>

      <!-- Desktop Right Actions -->
      <div class="hidden md:flex items-center space-x-4">
        @if (isAuthenticated()) {
        <!-- Create Item Button -->
        <button
          (click)="goToCreateItem()"
          class="btn-primary px-4 py-2 text-sm rounded-lg flex items-center space-x-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <g [innerHTML]="getIconSvg('plus')"></g>
          </svg>
          <span>List Item</span>
        </button>

        <!-- Notifications Bell -->
        <app-notification-bell></app-notification-bell>

        <!-- User Menu -->
        <div class="relative user-menu-container">
          <button
            (click)="toggleUserMenu()"
            class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100 transition-colors"
          >
            <div
              class="w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold text-sm overflow-hidden bg-gradient-to-br from-purple-400 to-pink-400"
            >
              @if (getProfilePhotoUrl()) {
              <img [src]="getProfilePhotoUrl()" alt="Profile" class="w-full h-full object-cover" />
              } @else {
              {{ getUserInitials() }}
              }
            </div>
            <svg
              class="w-4 h-4 text-gray-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M19 9l-7 7-7-7"
              ></path>
            </svg>
          </button>

          <!-- User Dropdown Menu -->
          @if (showUserMenu()) {
          <div
            class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-lg border border-gray-200 py-2 z-50"
          >
            <!-- User Info -->
            <div class="px-4 py-3 border-b border-gray-100">
              <div class="flex items-center space-x-3">
                <div
                  class="w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold overflow-hidden bg-gradient-to-br from-purple-400 to-pink-400"
                >
                  @if (getProfilePhotoUrl()) {
                  <img
                    [src]="getProfilePhotoUrl()"
                    alt="Profile"
                    class="w-full h-full object-cover"
                  />
                  } @else {
                  {{ getUserInitials() }}
                  }
                </div>
                <div>
                  <div class="font-medium text-gray-900">{{ currentUser()?.name || 'User' }}</div>
                  <div class="text-sm text-gray-500">{{ currentUser()?.email || '' }}</div>
                </div>
              </div>
            </div>

            <!-- Menu Items -->
            <div class="py-2">
              <button
                (click)="goToProfile()"
                class="w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
              >
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <g [innerHTML]="getIconSvg('user')"></g>
                </svg>
                Profile & Settings
              </button>

              <button
                routerLink="/booking-requests"
                (click)="showUserMenu.set(false)"
                class="w-full flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors"
              >
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <g [innerHTML]="getIconSvg('calendar')"></g>
                </svg>
                Booking Requests
              </button>

              <div class="border-t border-gray-100 my-2"></div>

              <button
                (click)="logout()"
                class="w-full flex items-center px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
              >
                <svg class="w-4 h-4 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <g [innerHTML]="getIconSvg('logout')"></g>
                </svg>
                Sign Out
              </button>
            </div>
          </div>
          }
        </div>
        } @else {
        <!-- Guest Actions -->
        <div class="flex items-center space-x-3">
          <a
            routerLink="/login"
            class="border border-purple-500 text-purple-700 font-medium rounded-lg px-4 py-2 text-sm text-center bg-white hover:bg-purple-50 transition-colors sm:w-auto w-full"
          >
            Sign In
          </a>
          <a
            routerLink="/register"
            class="btn-primary px-4 py-2 text-sm rounded-lg text-center sm:w-auto w-full"
          >
            Sign Up
          </a>
        </div>
        }
      </div>

      <!-- Mobile Menu Button -->
      <div class="md:hidden">
        <button
          (click)="toggleMobileMenu()"
          class="p-2 rounded-lg border-2 border-gray-400 bg-white shadow-sm hover:border-purple-500 hover:bg-gray-50 transition-colors mobile-menu-toggle flex items-center justify-center w-11 h-11"
          aria-label="Open navigation menu"
        >
          <div class="relative w-6 h-6 flex flex-col justify-center items-center">
            <span
              class="block absolute h-0.5 w-6 bg-gray-700 rounded transition-all duration-300"
              [ngClass]="showMobileMenu() ? 'rotate-45 top-3' : 'top-1'"
            ></span>
            <span
              class="block absolute h-0.5 w-6 bg-gray-700 rounded transition-all duration-300"
              [ngClass]="showMobileMenu() ? 'opacity-0 left-3' : 'top-3'"
            ></span>
            <span
              class="block absolute h-0.5 w-6 bg-gray-700 rounded transition-all duration-300"
              [ngClass]="showMobileMenu() ? '-rotate-45 top-3' : 'top-5'"
            ></span>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile Menu -->
  @if (showMobileMenu()) {
  <div class="md:hidden bg-white border-t border-gray-200 mobile-menu-container">
    <div class="px-4 py-4 space-y-2">
      <!-- Navigation Items -->
      @for (item of getFilteredNavItems(); track item.route) {
      <a
        [routerLink]="item.route"
        [class]="getMobileNavItemClass(item.route)"
        (click)="showMobileMenu.set(false)"
        class="relative"
      >
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <g [innerHTML]="getIconSvg(item.icon)"></g>
        </svg>
        {{ item.label }}
        @if (item.hasCount && item.label === 'Messages' && unreadMessagesCount() > 0) {
        <span
          class="ml-auto bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
        >
          {{ unreadMessagesCount() > 99 ? '99+' : unreadMessagesCount() }}
        </span>
        }
      </a>
      } @if (isAuthenticated()) {
      <!-- Create Item Button -->
      <button
        (click)="goToCreateItem()"
        class="w-full flex items-center px-4 py-3 text-purple-600 font-medium transition-colors"
      >
        <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <g [innerHTML]="getIconSvg('plus')"></g>
        </svg>
        List New Item
      </button>

      <!-- User Info -->
      <div class="border-t border-gray-200 pt-4 mt-4">
        <div class="flex items-center px-4 py-2 mb-2">
          <div
            class="w-10 h-10 rounded-full flex items-center justify-center text-white font-semibold mr-3 overflow-hidden bg-gradient-to-br from-purple-400 to-pink-400"
          >
            @if (getProfilePhotoUrl()) {
            <img [src]="getProfilePhotoUrl()" alt="Profile" class="w-full h-full object-cover" />
            } @else {
            {{ getUserInitials() }}
            }
          </div>
          <div>
            <div class="font-medium text-gray-900">{{ currentUser()?.name || 'User' }}</div>
            <div class="text-sm text-gray-500">{{ currentUser()?.email || '' }}</div>
          </div>
        </div>

        <button
          (click)="goToProfile()"
          class="w-full flex items-center px-4 py-3 text-gray-600 hover:bg-gray-50 transition-colors"
        >
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <g [innerHTML]="getIconSvg('user')"></g>
          </svg>
          Profile & Settings
        </button>

        <button
          (click)="logout()"
          class="w-full flex items-center px-4 py-3 text-red-600 hover:bg-red-50 transition-colors"
        >
          <svg class="w-5 h-5 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <g [innerHTML]="getIconSvg('logout')"></g>
          </svg>
          Sign Out
        </button>
      </div>
      } @else {
      <!-- Guest Actions -->
      <div class="border-t border-gray-200 pt-4 mt-4 flex flex-col gap-3">
        <a
          routerLink="/login"
          class="block px-4 py-3 border border-purple-500 text-purple-700 font-medium rounded-lg text-center bg-white hover:bg-purple-50 transition-colors w-full sm:w-auto"
          (click)="showMobileMenu.set(false)"
        >
          Sign In
        </a>
        <a
          routerLink="/register"
          class="block px-4 py-3 bg-purple-600 text-white font-medium rounded-lg text-center hover:bg-purple-700 transition-colors w-full sm:w-auto"
          (click)="showMobileMenu.set(false)"
        >
          Sign Up
        </a>
      </div>
      }
    </div>
  </div>
  }
</nav>
}
